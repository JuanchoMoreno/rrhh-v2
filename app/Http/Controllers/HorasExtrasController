<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\support\facades\DB;
use App\Models\User;
use App\Models\Departamentos;
use App\Models\Clases;
use App\Models\Ccostos;
use App\Models\Cargo;
use App\Models\TipoDoc;
use App\Models\HorasExtra;

class HorasExtrasController extends Controller
{
    public function index()
    {
        $horas_extras = HorasExtra::with('usuario', 'centroCosto')->get();
        $aprobadores = User::where('role', 'aprobador')->get(); // Ajusta esto según tu lógica de negocio

        return view('admin.horas_extras.index', compact('horas_extras', 'aprobadores'));
    }

    public function buscar_clase($id_depto)
    {
        try {
            $clases = DB::table('clases')->where('depart_id', $id_depto)->get();
            return view('admin.horas_extras.cargar_clases', compact('clases'));
            //code...
        } catch (\Exception $exception) {
            return response()->json(['mensaje' => 'ERROR']);
            //throw $th;
        }
    }

    public function buscar_ccosto($id_clase)
    {
        try {
            $ccostos = DB::table('ccostos')->where('clases_id', $id_clase)->get();
            return view('admin.horas_extras.cargar_ccostos', compact('ccostos'));
            //code...
        } catch (\Exception $exception) {
            return response()->json(['mensaje' => 'ERROR']);
            //throw $th;
        }
    }
    /**
     * Show the form for creating a new resource.
     */
    public function create()
    {
        return view('horas_extras.create');
    }

    /**
     * Store a newly created resource in storage.
     */
    public function store(Request $request)
    {
        $request->validate([
            'horas_extras_general_id' => 'required',
            'horas_extras_detalle_id' => 'required',
            'usuario_id' => 'required',
        ]);

        HorasExtra::create($request->all());

        return redirect()->route('horas_extras.index')->with('success', 'Horas Extra created successfully.');
    }

    /**
     * Display the specified resource.
     */
    public function show(HorasExtra $horasExtra)
    {
        return view('horas_extras.show', compact('horasExtra'));
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit(HorasExtra $horasExtra)
    {
        return view('horas_extras.edit', compact('horasExtra'));
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, HorasExtra $horasExtra)
    {
        $request->validate([
            'horas_extras_general_id' => 'required',
            'horas_extras_detalle_id' => 'required',
            'usuario_id' => 'required',
        ]);

        $horasExtra->update($request->all());

        return redirect()->route('horas_extras.index')->with('success', 'Horas Extra updated successfully.');
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy(HorasExtra $horasExtra)
    {
        $horasExtra->delete();

        return redirect()->route('horas_extras.index')->with('success', 'Horas Extra deleted successfully.');
    }
}